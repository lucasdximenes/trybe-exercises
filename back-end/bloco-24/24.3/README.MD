# [ExercÃ­cio do dia `24.3 - ORM - Associations N:N e Transactions`](./exercise/)

Esse Ã© o exercÃ­cio do conteÃºdo do dia `ORM - Associations N:N e Transactions`. Esse exercÃ­cio consolida as seguintes habilidades:

- Criar modelos
- Relacionar dois modelos com hasMany
- Relacionar dois modelos com belongsTo
- Relacionar dois modelos com belongsToMany
- Utilizar eager loading ou lazy loading

### Antes de iniciar o projeto

Nesse exercÃ­cio vamos criar uma API que serÃ¡ responsÃ¡vel pela gestÃ£o de um sistema de saÃºde. Nesse sistema terÃ£o pacientes, cada um com seu plano. Cada paciente pode ter realizado vÃ¡rias cirurgias, que por sua vez, devem ser listadas e categorizadas. O diagrama abaixo demonstra como o banco de dados se comportarÃ¡:

![Diagrama](./exercise/images/diagrama3.png)

Este repositÃ³rio jÃ¡ contÃ©m as dependÃªncias abaixo no `package.json`.

- express
- nodemon
- sequelize
- mysql2
- sequelize-cli

AlÃ©m disso, o exercÃ­cio jÃ¡ vem com a estrutura bÃ¡sica do Sequelize configurada, **nÃ£o serÃ¡ necessÃ¡rio inicializar ou criar migrations ou seeders para as tabelas**, pois ela jÃ¡ estÃ£o feitas.

SerÃ¡ necessÃ¡rio configurar o arquivo `config/config.js` com os dados de seu servidor. Para isso, crie um arquivo .env para configurar suas variÃ¡veis de ambiente. O arquivo .env.example contÃ©m um exemplo das variÃ¡veis de ambiente que devem ser configuradas.

ApÃ³s definir o `.env`, vamos fazer os seguintes passos:

1. Subir o container: `docker-compose up -d`;
2. Abrir o terminal do container criado: `docker compose exec api bash`; e
3. Instalar as dependÃªncias no container: `npm install`.

ApÃ³s instalar as dependÃªncias, utilize os comandos abaixo:

```bash
npx sequelize db:create
npx sequelize db:migrate
npx sequelize db:seed:all
```

Esses comandos vÃ£o criar respectivamente, a `database`, as `tables` e apÃ³s, inserir dados exemplos nas tabelas.

As tabelas criadas sÃ£o:

- Patients
- Patients_surgeries
- Plans
- Surgeries

Feito isso, ja podem ser realizados os exercÃ­cios abaixo.

### ExercÃ­cios

#### ğŸš€ ExercÃ­cio 1

Crie o model de `Plans`.

#### ğŸš€ ExercÃ­cio 2

Crie o model de `Patients`.

#### ğŸš€ ExercÃ­cio 3

Crie o model de `Surgeries`.

#### ğŸš€ ExercÃ­cio 4

Crie o model de `Patient_surgeries`.

#### ğŸš€ ExercÃ­cio 5

Crie um endpoint que liste todos os pacientes e seus respectivos planos.

#### ğŸš€ ExercÃ­cio 6

Crie um endpoint que liste todos os pacientes e suas respectivas cirurgias realizadas.

#### ğŸš€ ExercÃ­cio 7

Crie um endpoint que de acordo com o id de um plano, que deve ser recebido via requisiÃ§Ã£o, liste os pacientes que o possuem.

### BÃ´nus

#### ğŸš€ ExercÃ­cio 1

Crie um endpoint capaz de adicionar um novo paciente.

#### ğŸš€ ExercÃ­cio 2

Crie um endpoint que liste todos os pacientes e suas cirurgias realizadas, mas oculte o nome do mÃ©dico responsÃ¡vel.

#### ğŸš€ ExercÃ­cio 3

Crie um endpoint que de acordo com o nome do mÃ©dico, que deve ser recebido via requisiÃ§Ã£o, liste todas as cirurgias realizadas pelo mesmo, um get na url `http://localhost:3000/surgeries/Rey%20Dos%20Santos`deve retornar as cirurgias realizadas pelo mÃ©dico `Rey Dos Santos`.
